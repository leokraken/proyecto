@model SAREM.Web.Models.Consulta

@{
    ViewBag.Title = "Agendar Consulta";
    Layout = "~/Views/Shared/_User.cshtml";
}

<link rel="stylesheet" href="~/Content/boostrap-table/src/bootstrap-table.css">

@Scripts.Render("~/bundles/jquery")
<script src="~/Scripts/jquery-1.10.2.min.js" type="text/javascript"></script>
<script src="~/Scripts/bootstrap.min.js" type="text/javascript"></script>
<script src="~/Content/boostrap-table/src/bootstrap-table.js"></script>
<script src="~/Content/boostrap-table/src/locale/bootstrap-table-es-ES.js"></script>
<script src="~/Content/boostrap-table/src/extensions/filter-control/bootstrap-table-filter-control.js"></script>

<ol class="breadcrumb">
    <li><a href="#">Consultas</a></li>
    <li class="active">Agendar Consulta</li>
</ol>

<div class="paragraphs">
    <div class="row">
        <div class="span4">
            <div class="content-heading" style="margin-left:17px !important;">
                <h3 class="pull-left">Agendar Consulta &nbsp &nbsp &nbsp </h3>
                <img src="~/Content/images/agenda2.png" />
            </div>

        </div>
    </div>
</div>
<br />
<div>
    <div class="panel panel-info">
        <div class="panel-heading"><button type="button" class="btn btn-info" id="parteDiario">Buscar  &nbsp &nbsp  <i class="fa fa-search"></i></button> </div>
        <div class="panel-body">
               <div class="form-horizontal">
                  
                       <div class="form-group">
                           <label class="control-label col-md-2">Orígen:</label>
                           <div class="col-md-10">
                               @Html.DropDownListFor(
                        model => model.localID,
                        Model.local.Select(l => new SelectListItem
                        {
                            Text = l.nombre,
                            Value = l.LocalID.ToString()
                        }),
          "Seleccione un Orígen", new { style = "width:280px", @class = "origen_change" })
                               @Html.ValidationMessageFor(model => model.localID, "", new { @class = "text-danger" })
                           </div>
                       </div>

                      
                   <div id="especialidades" style="display:none">
                       <div class="form-group">
                           <label class="control-label col-md-2">Especialidad:</label>
                           <div class="col-md-10">

                               @Html.DropDownList("Especial", new SelectList(string.Empty, "Value", "Text"), "Seleccione una Especialidad", new { style = "width:280px", @class = "dropdown1" })
                           </div>
                       </div>
                   </div>
                   <div id="medicos" style="display:none">
                       <div class="form-group">
                           <label class="control-label col-md-2">Médico:</label>
                           <div class="col-md-10">
                               @Html.DropDownList("Medico", new SelectList(string.Empty, "Value", "Text"), "Seleccione un Médico", new { style = "width:280px", @class = "dropdown1" })
                           </div>
                       </div>
                   </div>
                   <div class="form-group">
                       <label class="control-label col-md-2">Fecha Consulta:</label>
                       <div class="col-md-10">
                           @Html.EditorFor(model => model.fecha_inicio, new { htmlAttributes = new { @id = "idFI", @class = "form-control datetimepicker", placeholder = "Seleccione una fecha.." } })
                           @Html.ValidationMessageFor(model => model.fecha_inicio, "", new { @class = "text-danger" })
                       </div>
                   </div>
               </div>
        </div>
    </div>

</div>

<script>
    $(document).ready(function () {


        $(".origen_change").change(function () {

            if ($(".origen_change option:selected").index() != 0) {

                $("#medicos").css("display", "none");
                $("#Especial").empty().append('<option value="0">Seleccione una Especialidad</option>');

                   
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("GetEspecialidades", "Consulta")',
                    dataType: 'json',
                    data: { idLocalidad: $(this).find('option:selected').val() },
                    cache: false,
                    success: function (data) {
                        //Fill div with results
                        // states contains the JSON formatted list
                        // of states passed from the controller

                         

                        $.each(data, function (i, dato) {
                            $("#Especial").append('<option value="' + dato.Value + '">' +
                                 dato.Text + '</option>');
                            // here we are adding option for States

                        });

                        $("#especialidades").css("display", "block");
                    },
                    error: function (ex) {
                        alert('Failed to retrieve states.' + ex);
                    }
                });
            }
        });

        $("#Especial").change(function () {
            if ($("#Especial option:selected").index() != 0) {
                $("#Medico").empty().append('<option value="0">Seleccione un Médico</option>');
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("GetMedicos", "Consulta")',
                    dataType: 'json',
                    data: { idEspecialidad: $(this).find('option:selected').val(), idLocalidad: $(".origen_change option:selected").val() },
                    cache: false,
                    success: function (data) {
                        //Fill div with results
                        // states contains the JSON formatted list
                        // of states passed from the controller

                        $.each(data, function (i, dato) {
                            $("#Medico").append('<option value="' + dato.Value + '">' +
                                 dato.Text + '</option>');
                            // here we are adding option for States

                        });

                        $("#medicos").css("display", "block");
                    },
                    error: function (ex) {
                        alert('Failed to retrieve states.' + ex);
                    }
                });

            }
        });



        $(function () {
            $('.datetimepicker').datetimepicker({
                locale: 'es',
                format: 'L'

            });

        });
    })
</script>